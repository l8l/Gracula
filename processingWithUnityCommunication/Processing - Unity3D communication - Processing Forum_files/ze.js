function ZE(a){this.state="loading",this.mode="richtext",this.afterload=[],this.initobj=a,this.outerdiv=document.getElementById(a.id),this.editordiv=undefined,this.toolbardiv=undefined,this.toolbarobject=undefined,this.popupid="ze_popups",this.popupdiv=undefined,this.createToolbar(),this.createEditor(),ZE_Init.needEditorStats&&(this.clickCount={}),ZE_Init.needplaintext&&(this.createPlainText(),a.mode==="plaintext"&&this.plainText(a.content))}ZE.create=function(a){if(ZE_Init.loading){var b=function(){ZE_Init.loadURL(ZE_Init.cssPath+"/css/"+ZE_Init.theme+"/ze1.min.css","css"),ZE_Init.is_ie?ZE_Init.loadURL(ZE_Init.jsPath+"/js/ze_ie1.min.js","js"):ZE_Init.loadURL(ZE_Init.jsPath+"/js/ze1.min.js","js")};setTimeout(b,0),delete ZE_Init.loading}return new ZE(a)},ZE.prototype.afterEditorLoad=function(a){var b=this;b.state?b.afterload.push(a):a()},ZE.prototype.setContent=function(a){var b=this,c,d=b.mode;if(!a)return;if(b.state)c=function(a){return function(){b.setContent(a)}}(a),b.afterload.push(c);else if(d&&d==="plaintext")b._textarea.value=a;else{b.doc.body.innerHTML=a,b.win.focus();try{b.updateToolbar()}catch(e){}}},ZE.setProcessedContent=function(a){var b=this,c=b.mode;c&&c==="plaintext"?a=a.replace(/\n/gi,"<br />"):a=a.replace(/<br.*?>/gi,"\n")},ZE.i18n=function(a){var b=ZE_Init.language;return!b||b=="en"?a:ZE.i18nObj[a]||a},ZE.prototype.getContent=function(){var a=this,b=a.mode,c=a.toolbarobject.spellcheck,d,e,f;c&&c.className==="ze_selected"&&a.removeSpellcheckspans();if(b&&b==="plaintext"){d=a._textarea;if(d){e=d.value;if(e)return ZE_Init.setContentProcessed&&(e=e.replace(/\r+/gi,""),e=e.replace(/\n/gi,"<br />")),e}}else{f=a.doc;if(f)return f.body.innerHTML}return""},ZE.prototype.createPlainText=function(){var a=this,b=document.createElement("span"),c=ZE.i18n;a.mode="richtext",a.span=b,b.innerHTML="&laquo; "+c("Plain Text"),b.className="ze_plain",b.onclick=function(b){b=b||window.event,a._stopEvent(b);if(confirm(c("Converting this to plain text will lose some formatting")+".\n\n"+c("Are you sure you want to continue")+"?")){var d=a.toolbarobject.spellcheck;d&&d.className==="ze_selected"&&a.removeSpellcheckEvent(),a.plainText(a.getContent()),ZE_Init.modeChange&&ZE_Init.modeChange(a.mode)}},a.toolbardiv.appendChild(b)},ZE.prototype.plainText=function(a){var b=this,c=b.toolbardiv.getElementsByTagName("ul"),d=b.span,e=ZE.i18n,f=b._textarea;for(var g=c.length-1;g>=0;g--)c[g].style.display="none";var h=b.toolbarobject.spellcheck;h&&(h.parentNode.parentNode.parentNode.style.display=""),d.innerHTML="&raquo; "+e("Rich Text"),d.style.display="",d.onclick=function(a){a=a||window.event,b._stopEvent(a),b.richText(b._textarea.value),ZE_Init.modeChange&&ZE_Init.modeChange(b.mode)},b.mode="plaintext",f||(f=document.createElement("textarea"),f.className="ze_area",b._textarea=f,b.editordiv.appendChild(f),f.onbeforedeactivate=function(){var a=document.selection;a&&(b.textrange=a.createRange())}),a&&(f.value=ZE.getText(a)),b.iframe.style.display="none",f.style.height=b.iframe.style.height,f.style.display="";try{f.focus(),f.setSelectionRange&&f.setSelectionRange(0,0)}catch(i){}},ZE.prototype.richText=function(a){var b=this,c=b.toolbardiv.getElementsByTagName("ul"),d=b.span,e=ZE.i18n,f=b._textarea;for(var g=c.length-1;g>=0;g--)c[g].style.display="";d.innerHTML="&laquo; "+e("Plain Text"),d.onclick=function(a){a=a||window.event,b._stopEvent(a);if(confirm(e("Converting this to plain text will lose some formatting")+".\n\n"+e("Are you sure you want to continue")+"?")){a=a||window.event,b._stopEvent(a);var c=b.toolbarobject.spellcheck;c&&c.className==="ze_selected"&&b.removeSpellcheckEvent(),b.plainText(b.getContent()),ZE_Init.modeChange&&ZE_Init.modeChange(b.mode)}},b.mode="richtext",f.style.display="none",a&&(b.doc.body.innerHTML=a.replace(/\ /gi," ").replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/gi,"<br>")),b.iframe.style.height=f.style.height,b.iframe.style.display="",setTimeout(function(){b.win.focus(),b.updateToolbar()},0)},ZE.getText=function(a){if(a){var b=function(a){return a=a.replace(/\n+/gi,""),a=a.replace(/\r+/gi,""),a=a.replace(/<!--.*?-->/gi,""),a=a.replace(/<head>.*?<\/head>/gi,""),a=a.replace(/<br.*?>/gi,"\n"),a=a.replace(/<hr.*?>/gi,"\n"),a=a.replace(/<\/p>/gi,"\n"),a=a.replace(/<\/div>/gi,"\n"),a=a.replace(/<\/h[1-6]>/gi,"\n"),a=a.replace(/<\/tr>/gi,"\n"),a=a.replace(/<\/li>/gi,"\n"),a=a.replace(/<\/td>/gi," "),a=a.replace(/<\/th>/gi," "),a=a.replace(/<.*?>/gi,""),a=a.replace(/&nbsp;/gi," "),a=a.replace(/&lt;/gi,"<"),a=a.replace(/&gt;/gi,">"),a=a.replace(/&amp;/gi,"&"),a},c=a.search(/<blockquote/gi);if(c!=-1){var d=a.search(/<blockquote/gi),e=a.toLowerCase().lastIndexOf("</blockquote>"),f=a.substring(d,e+13);return a=a.replace(f,"##===###===##"),f=b(f),f=f.replace(/\n/gi,"\n > "),f=" > "+f,a=b(a),a.search(/##===###===##/gi)!=-1&&(a=a.replace("##===###===##",f)),a}return b(a)}return""},ZE.prototype.setMode=function(a){var b=this,c=b.mode;a==="plaintext"?c!==a&&b.plainText(""):c!=="richtext"&&b.richText("")};ZE.prototype.updateToolbar=function(){var a=this,b=a.toolbarobject,c=a.doc,d,e;for(d in b)switch(d){case"bold":case"italic":case"underline":case"strikethrough":case"superscript":case"subscript":case"justifyleft":case"justifyright":case"justifycenter":case"justifyfull":case"insertorderedlist":case"insertunorderedlist":c.queryCommandState(d)?b[d].setAttribute("class","ze_selected"):b[d].removeAttribute("class");break;case"fontcolor":b[d].getElementsByTagName("img")[0].style.borderBottomColor=c.queryCommandValue("forecolor");break;case"bgcolor":e=c.queryCommandValue("hilitecolor"),/transparent/i.test(e)&&(e=c.queryCommandValue("backcolor")),b[d].getElementsByTagName("img")[0].style.borderBottomColor=e}},ZE.prototype.createEditor=function(){var a=this,b=document,c,d,e=a.initobj,f=e.editorheight;c=b.createElement("iframe"),a.iframe=c,c.className="ze_area",f&&(c.style.height=f+"px"),a.editordiv.appendChild(c),b.getElementById(a.popupid)||(d=b.createElement("div"),d.id=a.popupid,b.body.appendChild(d)),a.popupdiv=b.getElementById(a.popupid),c.onload=function(){c.onload=null;var b=c.contentWindow,d=b.document,f=e.content,g,h,i,j,k,l,m=ZE_Init.outGoingFontFamily,n=ZE_Init.outGoingFontSize;a.win=b,a.doc=d,e.mode!=="plaintext"&&(d.open(),d.write(f||"<br>"),d.close()),ZE_Init.editorCSS&&(g=d.createElement("link"),g.type="text/css",g.rel="stylesheet",g.href=ZE_Init.cssPath+"/css/zeditor.min.css",d.getElementsByTagName("head")[0].appendChild(g)),c.contentDocument.designMode="on";if(ZE_Init.needEditorFocus){b.focus();try{a.updateToolbar()}catch(o){}}d.addEventListener("mouseup",function(b){a.updateToolbar()},!0),d.addEventListener("keypress",function(c){var e=c.keyCode,f=c.shiftKey,g=c.metaKey,h=c.altKey,i=c.ctrlKey,j=a.doc,k;if(e===9)ZE_Init.tabKeyHandling&&!f&&!i&&(b.getSelection().collapseToStart(),d.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),a._stopEvent(c));else if((i||g)&&!h&&!f){k=String.fromCharCode(c.charCode).toLowerCase();switch(k){case"b":a.execCommand(c,"bold");break;case"i":a.execCommand(c,"italic");break;case"u":a.execCommand(c,"underline");break;case"l":a.execCommand(c,"justifyleft");break;case"e":a.execCommand(c,"justifycenter");break;case"r":a.execCommand(c,"justifyright");break;case"j":a.execCommand(c,"justifyfull");break;case"k":a.execCommand(c,"link")}}a.updateToolbar()},!0),j=function(a,b){var c;c=d.createElement("style"),c.type="text/css",c.innerHTML=".ze_body{font-family:"+a+";font-size:"+b+";}",d.getElementsByTagName("head")[0].appendChild(c),d.body.className="ze_body"},m||n?n?j(m,n):j(m,ZE_Init.defaultFontSize):(k=e.defaultfontfamily||ZE_Init.defaultFontFamily||"",l=e.defaultfontsize||ZE_Init.defaultFontSize||"",j(k,l)),delete a.state;if(a.afterload){h=a.afterload,i=h.length;while(i--)h.shift()()}delete a.afterload}},ZE.prototype._stopEvent=function(a){a.preventDefault(),a.stopPropagation()};ZE.prototype.createToolbar=function(){var a=this,b={},c,d=a.initobj.toolbar,e=document,f=e.createDocumentFragment(),g=ZE.i18n,h=ZE_Init.imgPath,i,j,k,l=0,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;d?c=ZE_Init.toolbarOrderGenerate(d):c=ZE_Init.toolbarOrder,i=e.createElement("div"),i.className="ze",ZE_Init.needEditorBorder||(i.style.borderWidth="0px"),a.editordiv=i,f.appendChild(i),a.toolbarobject=b,j=e.createElement("div"),j.className="ze_toolbarbg",i.appendChild(j),a.toolbardiv=j,k=function(b){return function(c){return a._stopEvent(c),a.execCommand(c,b),!1}};for(m=c.length;l<m;l++){n=e.createElement("ul"),n.className="ze_multitoolbar",o=e.createElement("li"),n.appendChild(o),p=e.createElement("div"),o.appendChild(p),q=c[l];for(r=0,s=q.length;r<s;r++){t=q[r],u=t[0],v=t[2],w=e.createElement("a"),w.title=w.href=g(t[1]),w.tabIndex="-1",w.addEventListener("click",k(u),!0),w.addEventListener("mousedown",function(b){return a._stopEvent(b),!1},!0),b[u]=w,p.appendChild(w),r===0&&w.appendChild(e.createElement("b")),x=e.createElement("img"),x.align="absmiddle",s===1?x.className="ze_tabmenuicon "+v+"si":x.className="ze_tabmenuicon "+v,x.src=h+"/images/spacer.gif",w.appendChild(x);if(r===s-1){w.insertBefore(e.createElement("em"),x);if(u==="insertoptions"||u==="spellcheckoptions")w.style.width="12px",z=w.previousSibling,z&&(A=z.previousSibling,A&&A.nodeName==="A"&&(A.style.width="25px"))}else y=e.createElement("img"),y.className="ze_sep_img",y.src=h+"/images/spacer.gif",p.appendChild(y)}j.appendChild(n)}b.heading&&function(){var a=b.heading.appendChild(e.createElement("span"));a.className="ze_heading_menu",a.appendChild(e.createTextNode("Nr"))}(),typeof ZE_Init.afterToolbarGenerate=="function"&&ZE_Init.afterToolbarGenerate(b),a.outerdiv.appendChild(f)};